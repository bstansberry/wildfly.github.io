<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Prospero documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>Prospero documentation</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a></li>
<li><a href="#_concepts">2. Concepts</a>
<ul class="sectlevel2">
<li><a href="#_feature_packs">2.1. Feature Packs</a></li>
<li><a href="#_channels">2.2. Channels</a></li>
</ul>
</li>
<li><a href="#_general_provisioning_process">3. General provisioning process</a>
<ul class="sectlevel2">
<li><a href="#_installation_process">3.1. Installation process</a></li>
<li><a href="#update_process">3.2. Update process</a></li>
</ul>
</li>
<li><a href="#_prospero_server_metadata">4. Prospero server metadata</a>
<ul class="sectlevel2">
<li><a href="#_prospero_update_history">4.1. Prospero update history</a></li>
</ul>
</li>
<li><a href="#_usage">5. Usage</a>
<ul class="sectlevel2">
<li><a href="#_installation">5.1. Installation</a></li>
<li><a href="#_update">5.2. Update</a></li>
<li><a href="#_channel_management">5.3. Channel management</a></li>
<li><a href="#_update_history">5.4. Update history</a></li>
<li><a href="#_replicating_installation">5.5. Replicating installation</a></li>
<li><a href="#_installing_additional_galleon_feature_packs">5.6. Installing additional Galleon Feature Packs</a></li>
</ul>
</li>
<li><a href="#_custom_channels">6. Custom channels</a>
<ul class="sectlevel2">
<li><a href="#_custom_artifact_versioning">6.1. Custom artifact versioning</a></li>
<li><a href="#_register_custom_channel">6.2. Register custom channel</a></li>
<li><a href="#_distributing_custom_artifacts">6.3. Distributing custom artifacts</a></li>
<li><a href="#_promoting_custom_artifacts">6.4. Promoting custom artifacts</a></li>
<li><a href="#_apply_changes_to_the_server">6.5. Apply changes to the server</a></li>
</ul>
</li>
<li><a href="#_working_with_channels">7. Working with channels</a>
<ul class="sectlevel2">
<li><a href="#_channels_with_fixed_version_manifests">7.1. Channels with fixed version manifests</a></li>
<li><a href="#_channels_using_backing_maven_repository_versions">7.2. Channels using backing Maven repository versions</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prospero is a tool designed to install and manage updates of Wildfly servers.</p>
</div>
<div class="paragraph">
<p>The tool supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provisioning Wildfly servers</p>
</li>
<li>
<p>Updating Wildfly servers</p>
</li>
<li>
<p>Reverting updates to Wildfly servers</p>
</li>
<li>
<p>Tracking updates history</p>
</li>
<li>
<p>Management of update sources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Prospero includes a CLI client and a programmatic API.</p>
</div>
<div class="paragraph">
<p>Releases of the command line tool will be available at <a href="https://github.com/wildfly-extras/prospero/releases/" class="bare">https://github.com/wildfly-extras/prospero/releases/</a>.</p>
</div>
<div class="paragraph">
<p>To use the tool, download and unzip the release zip, then add the bin directory to your system path. Use <code>prospero.sh</code> or <code>prospero.bat</code> to launch the tool.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">2. Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Wildfly servers are assembled from a large number of dependencies from various projects. If any of those components is changed, in the traditional update process, the server has to be rebuilt with updated components and distributed as a new version.</p>
</div>
<div class="paragraph">
<p>Prospero aims to simplify this process by allowing users to apply updated components to already provisioned servers.</p>
</div>
<div class="paragraph">
<p>To achieve that, Prospero utilizes two projects - Galleon and Wildfly Channels.</p>
</div>
<div class="sect2">
<h3 id="_feature_packs">2.1. Feature Packs</h3>
<div class="paragraph">
<p>Galleon is a provisioning tool used to assemble Wildfly distributions. In order for a piece of software to be provisioned by Galleon it needs to be packaged as a feature-pack.</p>
</div>
<div class="paragraph">
<p>Feature packs are ZIP archives usually available in Maven repositories. They contain information about installed software&#8217;s filesystem content, configuration and additional tasks needed to assemble and configure it.</p>
</div>
<div class="paragraph">
<p>In case of Wildfly server, the feature pack also contains a list of Maven coordinates for all the components included in the server distribution. During provisioning, those coordinates are used to download the components and place them in resulting server.</p>
</div>
<div class="paragraph">
<p>For more information on Galleon and the Feature Packs see the <a href="https://docs.wildfly.org/galleon/#_feature_packs">Galleon documentation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_channels">2.2. Channels</h3>
<div class="paragraph">
<p>Wildfly Channels are a way to provide a curated list of compatible, up-to-date components. A channel consists of a YAML definition file and one or more underlying Maven repositories.</p>
</div>
<div class="paragraph">
<p>There are two types of Wildfly Channels supported by Prospero - open channels and manifest channels. Open channels allow access to the latest artifacts in the underlying repository, while manifest channels define a list of allowed list of components.</p>
</div>
<div class="paragraph">
<p>For more information on Wildfly Channels see the <a href="https://github.com/wildfly-extras/wildfly-channel/blob/main/doc/spec.adoc">spec documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="_manifest_channels">2.2.1. Manifest channels</h4>
<div class="paragraph">
<p>One way to specify channel content is by using manifests. Manifests are YAML file listing streams available in the channel. For example a part of wildfly-27.0.0 manifest looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">schemaVersion: "1.0.0"
name: Manifest for WildFly 27
description: |-
  This manifest provides updates for WildFly 27 Feature Pack.
streams:
  - groupId: "org.wildfly"
    artifactId: "wildfly-galleon-pack"
    version: "27.0.0.Final"

  - groupId: "org.wildfly"
    artifactId: "wildfly-ee-galleon-pack"
    version: "27.0.0.Final"

  - groupId: "org.wildfly.core"
    artifactId: "wildfly-core-galleon-pack"
    version: "19.0.0.Beta13"

  - groupId: "org.wildfly.core"
    artifactId: "wildfly-version"
    version: "19.0.0.Final"

  - groupId: "org.wildfly.security"
    artifactId: "wildfly-elytron-jaspi"
    version: "1.20.2.Final"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel using this manifest would be defined as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">schemaVersion: "2.0.0"
name: Channel for WildFly 27
manifest:
  maven:
    groupId: org.wildfly.channels
    artifactId: wildfly-27.0
repositories:
  - id: central
    url: https://repo1.maven.org/maven2/</code></pre>
</div>
</div>
<div class="paragraph">
<p>When resolving artifacts using such channel, the versions of artifacts will be dictated by the manifest, even if newer version is available in the channel repositories.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The manifest can be distributed as either a static file (referenced in a channel by a URL), or as an artifact in a Maven repository.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_open_channels">2.2.2. Open channels</h4>
<div class="paragraph">
<p>Alternatively the channel can be defined to use the latest versions of artifacts available in its repositories.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">schemaVersion: "2.0.0"
name: Channel for WildFly 27
resolve-if-no-stream: latest
repositories:
  - id: central
    url: https://repo1.maven.org/maven2/</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general_provisioning_process">3. General provisioning process</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_process">3.1. Installation process</h3>
<div class="paragraph">
<p>Prospero delegates provisioning server to Galleon. When Galleon attempts to resolve components needed by the server, instead of using versions provided by the feature packs, Prospero intercepts that request and uses Wildfly Channels to find the correct version of the component and resolve it from the channels repositories.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/overview.png" alt="overview">
</div>
</div>
<div class="paragraph">
<p>Every time a server is provisioned, it will receive the latest available components.</p>
</div>
</div>
<div class="sect2">
<h3 id="update_process">3.2. Update process</h3>
<div class="paragraph">
<p>When new versions of components are made available, Prospero can apply those to existing servers. In order to find updates following steps are executed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the latest version of channel manifests from Maven repositories</p>
</li>
<li>
<p>Compare component versions in the server to the latest available versions in channels.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If updates are available, they will be applied to the server in a following process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Provision a new, updated server in a temporary directory.</p>
</li>
<li>
<p>Compare the changes between the new and old server.</p>
</li>
<li>
<p>Apply changes in the new server to the base server.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_resolving_update_conflicts">3.2.1. Resolving update conflicts</h4>
<div class="paragraph">
<p>Generally user modified files in the server will never be changed during the update.</p>
</div>
<div class="paragraph">
<p>Sometimes server files might be modified both in the base server and in an incoming update. An example of this might be a configuration file changed by the user to support their setup and changed in the update to modify a default configuration value.</p>
</div>
<div class="paragraph">
<p>In such case, the user changes are persisted and not modified. The new, updated file configuration is created next to the old file with a <code>.glnew</code> suffix, and the user is notified that there was a conflict. The user can resolve the conflict manually after the update.</p>
</div>
<div class="paragraph">
<p>The exception to this rule are files considered to be <code>system paths</code>. They should not be modified by the user and will always be kept in sync with the changes provided by the updates. Any user changes will be replaced during the update and stored with a <code>.glold</code> suffix. An example of such files is a content of <code>modules/system</code> folder.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User modified</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update modified</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Original file is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updated version is used. Original file is discarded</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updated version is used. Original file is persisted with <code>.glold</code> suffix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Original file is used. Updated version is persisted with <code>.glnew</code> suffix</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_update_operation_limitations">3.2.2. Update operation limitations</h4>
<div class="paragraph">
<p>During "<strong>apply changes</strong>" phase of updates, any processes using server&#8217;s resources need to be stopped to avoid resource locking issues. The user should manually shut down the server before performing update.</p>
</div>
<div class="paragraph">
<p>To reduce server downtime, the update operation can be performed in two steps - <code>prepare</code> and <code>apply</code>. In the first step, a candidate update server is provisioned in a new directory. The second step, compares the changes between the candidate and the base server and applies them to the base server.</p>
</div>
<div class="paragraph">
<p>If the update is split into separate steps, the <code>prepare</code> step can be performed while the server is running. See <a href="#_working_with_update_candidates">Working with update candidates</a> for details.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prospero_server_metadata">4. Prospero server metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order for Prospero to be able to update a server, the server installation has to contain some additional metadata files. Those files contain information about server&#8217;s current state and the subscribed channels. The metadata is generated when the server is installed and can be modified using Prospero commands.</p>
</div>
<div class="paragraph">
<p>The metadata is split between <code>&lt;SERVER_HOME&gt;/.galleon</code> and <code>&lt;SERVER_HOME&gt;/.installation</code> folders.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>&lt;SERVER_HOME&gt;/.installation/installer-channels.yaml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of channels the server is subscribed to receive updates from</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>&lt;SERVER_HOME&gt;/.installation/manifest.yaml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record of current versions of components installed in the server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>&lt;SERVER_HOME&gt;/.installation/manifest_version.yaml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Record of channel manifests used to provision current server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>&lt;SERVER_HOME&gt;/.galleon/provisioning.xml</code> <code>&lt;SERVER_HOME&gt;/.galleon/provisioned.xml</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gallon files recording provisioned feature-packs and their customizations.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_prospero_update_history">4.1. Prospero update history</h3>
<div class="paragraph">
<p>The files in the <code>.installation/</code> and <code>.galleon/</code> folders should only be modified via the prospero tool, not manually. All metadata changes performed by prospero tool are internally versioned and can be later reviewed or rolled back by using the <code>prospero history</code> and <code>prospero revert</code> commands.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage">5. Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation">5.1. Installation</h3>
<div class="paragraph">
<p>To provision a server, Prospero requires following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>manifest definition</p>
</li>
<li>
<p>location of channel&#8217;s Maven repositories</p>
</li>
<li>
<p>server provisioning configuration</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_installing_predefined_server_profile">5.1.1. Installing predefined server profile</h4>
<div class="paragraph">
<p>Prospero provides a set of predefined profiles providing a simple way to install standard servers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh install \
      --dir wfly-27 \
      --profile wildfly \
      --manifest /path/to/wildfly-manifest.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The profile defines a feature-pack name and required repositories. It can also provide manifest information, if that manifest is published in a Maven repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="_installing_a_feature_pack">5.1.2. Installing a feature pack</h4>
<div class="paragraph">
<p>If a desired server configuration is not provided by one of the profiles, Prospero can provision a feature pack based on its Maven coordinates (groupId:artifactId). The resulting server will have a default configuration provided by that feature pack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh install \
      --dir wfly-27 \ # <b class="conum">(1)</b>
      --fpl org.wildfly:wildfly-ee-galleon-pack \ #<b class="conum">(2)</b>
      --manifest /path/to/wildfly-manifest.yaml \ #<b class="conum">(3)</b>
      --repositories https://repo1.maven.org/maven2/,https://repository.jboss.org/nexus/content/groups/public/ #<b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>directory to place provisioned server in</p>
</li>
<li>
<p>Maven <code>&lt;groupId&gt;:&lt;artifactId&gt;</code> coordinates of the feature pack to be installed</p>
</li>
<li>
<p>Path to the manifest file</p>
</li>
<li>
<p>List of Maven repositories containing components listed in the channel file.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
An example Wildfly manifest file is available in examples directory.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_installing_a_customized_feature_pack">5.1.3. Installing a customized feature pack</h4>
<div class="paragraph">
<p>Galleon feature packs consist of <a href="https://docs.wildfly.org/galleon/#_layers">layers</a> and <a href="https://docs.wildfly.org/galleon/#_feature_pack_packages">packages</a> that can be excluded or included to generate customized server.</p>
</div>
<div class="paragraph">
<p>In order to create a customized installation, the required provisioning configuration need to be described in <code>provisioning.xml</code> file. For example, following file adds configuration examples to the generated server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" ?&gt;
&lt;installation xmlns="urn:jboss:galleon:provisioning:3.0"&gt;
    &lt;feature-pack location="org.wildfly:wildfly-galleon-pack::zip"&gt;
      &lt;packages&gt;
        &lt;include name="docs.examples.configs"/&gt;
      &lt;/packages&gt;
    &lt;/feature-pack&gt;
&lt;/installation&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provisioning definition can then be used to create a server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh install \
      --dir wfly-27 \
      --definition provisioning.xml \
      --manifest /path/to/wildfly-manifest.yaml
      --repositories https://repo1.maven.org/maven2/,https://repository.jboss.org/nexus/content/groups/public/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_offline_or_mirrored_repositories">5.1.4. Using offline or mirrored repositories</h4>
<div class="paragraph">
<p>By default, any artifacts required to provision the server, will be resolved using public repositories. If the system on which the installation is performed doesn&#8217;t have access to the required repositories, alternative repositories need to provided using the <code>--repositories</code> argument.</p>
</div>
<div class="paragraph">
<p>The specified repositories can either be mirrors of public repositories, or local filesystem copies of the repositories. One way to generate such repository is installing the server on an online system using <code>--local-cache</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh install \ #<b class="conum">(1)</b>
      --dir wfly-27 \
      --profile wildfly \
      --manifest /path/to/wildfly-manifest.yaml \
      --local-cache /path/to/local_repo

$ ./prospero.sh install \ #<b class="conum">(2)</b>
      --dir offline-wfly-27 \
      --profile wildfly \
      --manifest /path/to/wildfly-manifest.yaml \
      --repositories /path/to/local_repo \
      --offline</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Generates a repository at <code>/path/to/local_repo</code></p>
</li>
<li>
<p>Installs the server using content of <code>/path/to/local_repo</code> instead of default repositories</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When using a &lt;groupId&gt;:&lt;artifactId&gt; to resolve manifest from a repository, the manifest artifact has to have accompanying Maven metadata (maven-metadata.xml).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_selecting_stability_level_of_provisioned_server">5.1.5. Selecting stability level of provisioned server</h4>
<div class="paragraph">
<p>Some feature packs may contain experimental or preview features not intended to be made available by default. To separate those features from stable ones, feature packs may segregate the features into <code>stability-levels</code>. At the provisioning time, the user is able to change the default stability level of the feature pack by using the <code>--stability</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh install \ #<b class="conum">(1)</b>
      --dir wfly-31 \
      --profile wildfly \
      --manifest /path/to/wildfly-manifest.yaml \
      --stability preview</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more fine-grained control, the level of installed packages and configuration can be set separately using <code>--config-stability</code> and <code>--package-stability</code> flags.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update">5.2. Update</h3>
<div class="paragraph">
<p>Once the server is installed, it can receive updates published in the channels it is subscribed to.</p>
</div>
<div class="paragraph">
<p>Following command can be used to update the server using the subscribed channels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh update perform --dir wfly-27</code></pre>
</div>
</div>
<div class="paragraph">
<p>If any updates are available, Prospero will print the update summary and prompt for confirmation to continue. If the updates are accepted, the updated server will be prepared in a way described in <a href="#update_process">Update process</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The server has to be stopped during <code>update perform</code> operation
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_checking_updates">5.2.1. Checking updates</h4>
<div class="paragraph">
<p><code>prospero update list</code> command can be used to check if any updates are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh update list --dir wfly-27</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_update_candidates">5.2.2. Working with update candidates</h4>
<div class="paragraph">
<p>When using <code>prospero update perform</code> command, the server has to be stopped during the whole update process. In order to reduce server downtime, it is possible to generate an update candidate while the server is running and apply it to a stopped server in a separate step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./wfly-27/bin/standalone.sh &gt; /dev/null &amp; # <b class="conum">(1)</b>

$ ./prospero.sh update prepare \ # <b class="conum">(2)</b>
       --dir wfly-27 \
       --candidate-dir candidate-dir \
       --yes

$ ./wfly-27/bin/jboss-cli.sh -c "shutdown" # <b class="conum">(3)</b>

$ ./prospero.sh update apply \ # <b class="conum">(4)</b>
       --dir wfly-27 \
       --candidate-dir candidate-dir</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>start the server in background</p>
</li>
<li>
<p>generate the candidate in <code>candidate-dir</code> folder</p>
</li>
<li>
<p>stop the server</p>
</li>
<li>
<p>merge the updates found in <code>candidate-dir</code> into <code>wfly-27</code> server</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Update candidate is a temporary server provisioned by prospero. It is generated using the latest updates available in the channels, but does not contain any user modifications of the original server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The candidate can only be applied to a server it was based on and only if the server has not been updated since the candidate was generated.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_alternative_repository">5.2.3. Using alternative repository</h4>
<div class="paragraph">
<p>If the repositories defined in subscribed channels are not available to the server, alternative repositories can be provided using <code>--repositories</code> parameter. Those repositories can point to a local copy of the repository or alternate online location.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh update perform \
       --dir wfly-27 \
       --repositories https://proxy.corp.org/maven-central # <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The updates will be resolved from <strong><a href="https://proxy.corp.org/maven-central" class="bare">https://proxy.corp.org/maven-central</a></strong> instead of the default repository.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>--repositories</code> can also be used to resolve artifact from a local copy of the repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh update perform \
       --dir wfly-27 \
       --repositories /path/to/repository</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
At minimum, the alternative repositories have to provide all the channel manifests that the server is subscribed to and updated artifacts.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_subscribing_existing_server">5.2.4. Subscribing existing server</h4>
<div class="paragraph">
<p>Prospero relies on additional metadata files being present in the server installation to provide updates. Using <code>update subscribe</code> command it is possible to generate required files in a server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh update subscribe \
       --dir wfly-27 \
       --product=wildfly \ # <b class="conum">(1)</b>
       --version=29.0.1.Final # <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>name of the installed server, or name of the feature pack used to install the server</p>
</li>
<li>
<p>version of installed server or feature pack</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The product and version information is needed to determine currently installed software and subscribe server to correct channels.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_channel_management">5.3. Channel management</h3>
<div class="paragraph">
<p>The server subscribes to the channels to receive updates from them. The list of subscriptions can be managed using <code>prospero channel</code> subcommands.</p>
</div>
<div class="sect3">
<h4 id="_listing_channels">5.3.1. Listing channels</h4>
<div class="paragraph">
<p>Command <code>prospero channel list</code> prints a summary of subscribed channels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./prospero.sh channel list --dir wfly-27
Server /tmp/wfly-27 is subscribed to following channels:

-------
# channel-0
  manifest: org.wildfly.channel:wfly-27
  repositories:
    id: central
    url: https://repo1.maven.org/maven2/
-------</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_subscribing_to_a_channel">5.3.2. Subscribing to a channel</h4>
<div class="paragraph">
<p>Command <code>prospero channel add</code> subscribes the server to receive updates from additional channels. Each channel has to have a unique name, a manifest and a list of repositories. The channel&#8217;s artifacts will be used to resolve artifacts during next <code>update</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./prospero.sh channel add \
   --channel-name dev-channel \
   --manifest org.prospero.channel:wfly-27-dev \ # <b class="conum">(1)</b>
   --repositories file:/tmp/dev-repository \ # <b class="conum">(2)</b>
   --dir wfly-27
Subscribing /tmp/wfly-27 to channel dev-channel

Channel 'dev-channel' added.</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Maven coordinates (groupId:artifactId) of the new channel&#8217;s manifest</p>
</li>
<li>
<p>The Maven repository where the manifest and artifacts can be found in</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_unsubscribing_from_a_channel">5.3.3. Unsubscribing from a channel</h4>
<div class="paragraph">
<p>Command <code>channel remove</code> unsubscribes the server from a selected channel, stopping it from receiving updates from that channel. The artifacts previously installed from that channel will be replaced with artifacts available in remaining channel during next <code>update</code> operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./prospero.sh channel remove \
   --channel-name dev-channel \
   --dir installation-dir
Unsubscribing /tmp/wfly-27 from channel dev-channel

Channel 'dev-channel' removed.</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_history">5.4. Update history</h3>
<div class="paragraph">
<p>Each time the server is updated, the previous state of the server is recorded. That state includes the channels used to perform the update and the versions of artifacts used to build the server.</p>
</div>
<div class="paragraph">
<p>This information is used to restore the server back to past state.</p>
</div>
<div class="sect3">
<h4 id="_viewing_history">5.4.1. Viewing history</h4>
<div class="paragraph">
<p>Command <code>history</code> displays a list of all server updates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-base" data-lang="base">$ ./prospero.sh history --dir wfly-27
[02805caa] 2023-05-25T15:07:19Z - update [org.wildfly.channel:wfly-27::1.0.1]
[c5215591] 2023-05-25T15:05:04Z - install [org.wildfly.channel:wfly-27::1.0.0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server state record contains following information: a hash identifier, date of the change, type of the change (installation, update, configuration change) and a summary of channel manifests used in that update.</p>
</div>
<div class="paragraph">
<p>The details of each record can be examined using <code>--revision</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-base" data-lang="base">$ ./prospero.sh history --dir wfly-27 --revision 02805caa
Updates:
  [Updated artifact] io.undertow:undertow-servlet:		2.2.18.Final ==&gt; 2.2.19.Final
  [Updated artifact] io.undertow:undertow-websockets-jsr:		2.2.18.Final ==&gt; 2.2.19.Final
  [Updated artifact] io.undertow:undertow-core:		2.2.18.Final ==&gt; 2.2.19.Final</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reverting_updates">5.4.2. Reverting updates</h4>
<div class="paragraph">
<p>The server can be reverted to any of the recorded states. The <code>revert</code> commands operate in similar way to <code>update</code>. For example, a following command performs a full revert of a server to an earlier installation state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-base" data-lang="base">$ ./prospero.sh revert perform --dir wfly-27 --revision c5215591
Reverting server /tmp/wfly-27 to state c5215591

Feature-packs resolved.
Packages installed.
Downloaded artifacts.
JBoss modules installed.
Configurations generated.

Reverted server prepared, comparing changes
Changes found:
  io.undertow:undertow-servlet                          2.2.19.Final         ==&gt;  2.2.18.Final
  io.undertow:undertow-websockets-jsr                   2.2.19.Final         ==&gt;  2.2.18.Final
  io.undertow:undertow-core                             2.2.19.Final         ==&gt;  2.2.18.Final
Continue with revert [y/N]: y
Applying changes

Server reverted to state 348b9d9c.
Operation completed in 45.83 seconds.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The revert process works similar to the update process, but instead of resolving component versions from subscribed channels, the component versions recorded in the requested state will be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The required components will be downloaded from the channel repositories the server was subscribed to at the requested state. If the channel repositories are no longer available, or do not provide the required component versions, <code>--repositories</code> can be used to overwrite them.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The server has to be switched off for the duration of the <code>revert perform</code> operation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_reverting_updates_using_candidate">5.4.3. Reverting updates using candidate</h4>
<div class="paragraph">
<p>Similarly to <code>update</code> operation, the <code>revert</code> operation can be split into preparing the candidate and applying the changes. In such case, the server downtime is only required during the latter phase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh revert prepare \ #<b class="conum">(1)</b>
    --candidate-dir candidate \
    --revision c5215591 \
    --dir wfly-27
Building revert candidate for /tmp/wfly-27

Feature-packs resolved.
Packages installed.
Downloaded artifacts.
JBoss modules installed.
Configurations generated.

Update candidate generated in /Users/spyrkob/workspaces/set/prospero/prospero/candidate
Operation completed in 22.22 seconds.

$  ./prospero.sh revert apply \ #<b class="conum">(2)</b>
    --dir wfly-27 \
    --candidate-dir candidate
Reverting server /tmp/wfly-27 to state ab39b0c6

Changes found:
  io.undertow:undertow-servlet                          2.2.19.Final         ==&gt;  2.2.18.Final
  io.undertow:undertow-websockets-jsr                   2.2.19.Final         ==&gt;  2.2.18.Final
  io.undertow:undertow-core                             2.2.19.Final         ==&gt;  2.2.18.Final
Continue with revert [y/N]: y
Applying changes

Server reverted to state ab39b0c6.
Operation completed in 9.40 seconds.</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Prepare a revert candidate in <code>candidate</code> folder</p>
</li>
<li>
<p>Apply prepared <code>candidate</code> to a server in <code>wfly-27</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_replicating_installation">5.5. Replicating installation</h3>
<div class="paragraph">
<p>Sometimes it might be needed to provision a copy of the server, with the same components as the original, in a different environment. To achieve that, Prospero requires following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a list of component versions used to provision the server,</p>
</li>
<li>
<p>a list of channels used during provisioning,</p>
</li>
<li>
<p>a list of Galleon feature packs used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This information can be obtained from any provisioned server using <code>clone export</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero.sh clone export --dir wfly-27 --path snapshot.zip
Exporting /tmp/wfly-27 installation details to /tmp/snapshot.zip
Export complete</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated archive contains following files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Archive:  snapshot.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
    68301  05-26-2023 15:59   manifest.yaml
      476  05-26-2023 15:59   installer-channels.yaml
      606  05-26-2023 15:59   provisioning.xml
---------                     -------
    69383                     3 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>The archive can be used to rebuild the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./prospero clone recreate --dir cloned --path export.zip
Recreating a server in /tmp/cloned based on /tmp/export.zip

Provisioning configuration:
 * org.wildfly:wildfly-galleon-pack:zip
Subscribed channels:
# wildfly
  manifest: org.wildfly.channel:wfly-27
  repositories:
    id: central
    url: https://repo1.maven.org/maven2/
    id: jboss-public
    url: https://repository.jboss.org/nexus/content/groups/public/
    id: mrrc
    url: https://maven.repository.redhat.com/ga/
    id: local-repo
    url: file:/Users/spyrkob/workspaces/set/prospero/prospero/test-repo

Feature-packs resolved.
Packages installed.
Downloaded artifacts.
JBoss modules installed.
Configurations generated.

Server installation was restored.
Operation completed in 28.12 seconds.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The user changes made to the original server are not applied to the clone.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_installing_additional_galleon_feature_packs">5.6. Installing additional Galleon Feature Packs</h3>
<div class="paragraph">
<p>Galleon feature packs can be used to extend capabilities offered by base server and provide features like, for example, <a href="https://github.com/wildfly-extras/wildfly-datasources-galleon-pack">datasource support</a> or <a href="https://github.com/wildfly-extras/wildfly-myfaces-feature-pack">alternative JSF implemetnation</a>.</p>
</div>
<div class="paragraph">
<p>Prospero allows users to install such feature pack on top of existing server using <code>feature-pack add</code> operation.</p>
</div>
<div class="sect3">
<h4 id="_feature_pack_channels">5.6.1. Feature pack channels</h4>
<div class="paragraph">
<p>As with all the components used to provision the server, Prospero relies on channels to supply the feature pack and any artifacts it may require. In some cases the base server channel may offer the additional feature packs, in others, an additional channel will have to be registered with the server. See <a href="#_subscribing_to_a_channel">Subscribing to a channel</a> for information how to subscribe to a channel.</p>
</div>
<div class="paragraph">
<p>Sometimes feature packs may require additional artifacts whose lifecycle is separate from the feature pack itself. For example, Datasources feature pack lets users specify which version of database driver should be installed irrespective of the feature pack version. In such cases users have to create and subscribe to a new channel providing those artifacts.</p>
</div>
<div class="paragraph">
<p>For example, a channel supplying Datasources feature pack could use <a href="https://repo1.maven.org/maven2">Maven Central</a> repository and a following manifest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>schemaVersion: 1.0.0
streams:
  - groupId: org.wildfly
    artifactId: wildfly-datasources-galleon-pack
    version: 4.0.1.Final
  - groupId: com.mysql
    artifactId: mysql-connector-j
    version: 8.1.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installing_feature_pack">5.6.2. Installing feature pack</h4>
<div class="paragraph">
<p>The feature packs are identified by GroupId:ArtifactId part of their Maven coordinates. This is known as their Feature Pack Location (fpl).</p>
</div>
<div class="paragraph">
<p>For example, assuming the server is subscribed to a datasources channel, following command will install the datasources feature pack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ prospero feature-pack add \
  --fpl org.wildfly:wildfly-datasources-galleon-pack \
  --dir wildfly</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This specific command does not in fact install any database drivers or datasources. See further examples bellow to see how to specify drivers and datasources to install or refer to <a href="https://github.com/wildfly-extras/wildfly-datasources-galleon-pack">wildfly-datasources documentation</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_installed_feature_packs">5.6.3. Customizing installed feature packs</h4>
<div class="paragraph">
<p>The Galleon feature packs may provide different capabilities using <a href="https://docs.wildfly.org/galleon/#_layers">layers</a>. Users may select a set of layers to install using <code>--layers</code> parameter.</p>
</div>
<div class="paragraph">
<p>If the feature pack changes server configuration files, the user may also choose which server configuration should be affected using <code>--target-config</code> parameter. If not provided, the layer configuration will use default values. Most Wildfly feature packs provide only a single model (standalone) and the default configuration file of standalone.xml.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the affected configuration file has been modified by the user, that file will not be modified. Instead, a new configuration file with suffix <code>.glnew</code> will be created with the changes.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some feature packs do not allow customization of layers or selected configuration files. Those feature packs have to be installed without <code>--layers</code> or <code>--target-config</code> parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example to install mysql support and configure the datasource in Wildfly <code>standalone-full.xml</code> configuration file, a following command can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ prospero feature-pack add \
  --fpl org.wildfly:wildfly-datasources-galleon-pack \
  --layers=mysql-datasource \
  --target-config=standalone-full.xml \
  --dir wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the feature pack provides multiple configuration model, the configuration name can be prefixed with model name e.g. <code>--target-config standalone/standalone.xml</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_offline_installation">5.6.4. Offline installation</h4>
<div class="paragraph">
<p>Similarly to other operations, <code>feature-pack add</code> can be executed in an offline mode. To do so, users should provide local repositories with all required artifacts (both for base server and the new feature) using <code>--repositories</code> parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_installation_history">5.6.5. Installation history</h4>
<div class="paragraph">
<p>Installing a feature pack is recorded in the server history as <strong>feature_add</strong> event. Displaying the <strong>feature_add</strong> revision shows details of installed feature pack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>./prospero history --dir installation-dir  --revision f7488855
Updates:
  [Added artifact] org.wildfly:wildfly-datasources-galleon-pack:		[] ==&gt; 4.0.1.Final

Installed features changes:
  [Added Feature Pack] org.wildfly:wildfly-datasources-galleon-pack::zip@maven</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_channels">6. Custom channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes a server needs to be updated with different versions of components than other servers. To achieve that, a server can subscribe to a custom channel on top of its normal channels. This channel will define modified versions of components.</p>
</div>
<div class="paragraph">
<p>For example if the main channel defines component <code>foo:bar:1.2.3</code>, the custom channel could contain <code>foo:bar:1.2.3-patch0001</code>. During any update operations, the most recent version of the <code>foo:bar</code> across both channels will be applied to the server.</p>
</div>
<div class="paragraph">
<p>The custom channel needs to be hosted in a Maven repository - either a local filesystem repository on the same system as the server, or a web repository shared between a group of servers. The repository is used to host a versioned channel definition and all customized artifacts.</p>
</div>
<div class="sect2">
<h3 id="_custom_artifact_versioning">6.1. Custom artifact versioning</h3>
<div class="paragraph">
<p>When multiple versions of the same artifact are available from different channels, Prospero will always choose the latest available version of this artifact.</p>
</div>
<div class="paragraph">
<p>Therefore, the customized artifacts have to always have higher versions than artifacts they are replacing. For instance, if a server includes <code>my:artifact:1.1.0</code>, the customization channel can provide a version <code>my:artifact:1.1.0-path-00001</code> or <code>my:artifact:1.1.1</code>, but not <code>my:artifact:1.0.9</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_register_custom_channel">6.2. Register custom channel</h3>
<div class="paragraph">
<p>In order for the server to receive updates from a custom channel, the server needs to be subscribed to the channel and associated repositories.</p>
</div>
<div class="paragraph">
<p>The channel can be hosted either in an internal installation repository, serving a single server or in a shared repository. To configure the server with a custom channel following commands can be used:</p>
</div>
<div class="paragraph">
<p><strong>Single server channel</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>prospero channel add \
  --channel-name customizations \
  --repositories file:/path/to/local/repository \
  --manifest org.wildfly.prospero:customizations</code></pre>
</div>
</div>
<div class="paragraph">
<p>A server can use a filesystem repository and auto-generated channel to provide customizations. This command will register the server to recieve updates from a Maven repository in <code>/path/to/local/repository</code> folder.</p>
</div>
<div class="paragraph">
<p>The customized artifacts should be listed in a manifest file deployed to the above repository as <code>org.wildfly.prospero:customizations:manifest:yaml:&lt;VERSION&gt;</code></p>
</div>
<div class="paragraph">
<p><strong>Shared channel</strong></p>
</div>
<div class="paragraph">
<p>An online repository can be used to distribute the customizations among multiple servers. Each server has to be subscribed to the repository using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>prospero channel add \
  --channel-name customizations \
  --repositories http://repository.host/path \
  --manifest=org.wildfly.prospero:customizations</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The repository can be used to host customizations applicable to a different group of servers. In that case each set of customizations would have a separate manifest deployed under unique Maven <code>groupId:artifactId</code> coordinates.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_distributing_custom_artifacts">6.3. Distributing custom artifacts</h3>
<div class="paragraph">
<p>The customized artifacts can be distributed as bundles. Each bundle is a ZIP archive containing a <code>maven-repository</code> directory and an optional <code>artifact-list.yaml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>|-artifact-list.yaml
|-maven-repository
  |- org
    |-custom
      |-artifact-one
        |-1.2.3
          |-artifact-one-1.2.3.jar
      |-artifact-two
        |-2.3.4
          |-artifact-two-2.3.4.jar
    |-wildfly
      |-prospero
        |-customizations
          |-1.0.0
            |-customizations-manifest-1.0.0.yaml
          |-maven-metadata.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the custom artifacts, repository has to contain a channel manifest. The manifest should list all streams available in the customization bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>schemaVersion: 1.0.0
name: Customizations manifest
streams:
  - groupId: org.custom
    artifactId: artifact-one
    version: 1.2.3
  - groupId: org.custom
    artifactId: artifact-two
    version: 2.3.4</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the Maven metadata has to be present for the manifest artifact.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>artifact-list.yaml</code> lists all artifacts included in the bundle using following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>artifacts:
  - groupId: "org.custom"
    artifactId: "artifact-one"
    version: "1.2.3"
    packaging: "jar"
    extension: ""</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_updating_custom_artifacts">6.3.1. Updating custom artifacts</h4>
<div class="paragraph">
<p>If a new version of customization bundle needs to be distributed, it should contain a customization manifest deployed under the same <code>groupId:artifactId</code> coordinates, but with an incremented version.</p>
</div>
<div class="paragraph">
<p>The repository should contain all customized artifacts required by the updated manifest. For instance, the updated manifest included a new version of <code>artifact-one</code> and added <code>artifact-three</code>, resulting in following file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>schemaVersion: 1.0.0
name: Customizations manifest
streams:
  - groupId: org.custom
    artifactId: artifact-one
    version: 1.2.4
  - groupId: org.custom
    artifactId: artifact-two
    version: 2.3.4
  - groupId: org.custom
    artifactId: artifact-three
    version: 3.4.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>The updated repository should contain three artifacts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>|-artifact-list.yaml
|-maven-repository
  |- org
    |-custom
      |-artifact-one
        |-1.2.4
          |-artifact-one-1.2.4.jar
      |-artifact-two
        |-2.3.4
          |-artifact-two-2.3.4.jar
      |-artifact-three
        |-3.4.5
          |-artifact-two-3.4.5.jar
    |-wildfly
      |-prospero
        |-customizations
          |-1.0.1
            |-customizations-manifest-1.0.1.yaml
          |-maven-metadata.xml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_promoting_custom_artifacts">6.4. Promoting custom artifacts</h3>
<div class="paragraph">
<p>To make the custom artifact available to registered servers, the update artifacts from the customization bundle have to be added to the existing repository.</p>
</div>
<div class="paragraph">
<p>The updated artifacts are distributed in a <code>maven-repository</code> folder inside the customization archive. If the server is subscribed to a local filesystem customization repository, all the artifacts can be simply copied over.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ./prospero.sh channel list
# customizations
  manifest: org.wildfly.prospero:customizations
  repositories:
    id: custom-repo-0
    url: file:/home/wildfly/custom/repository # <b class="conum">(1)</b>

$ unzip customization-1.0.1.zip # <b class="conum">(2)</b>
Archive:  customization-1.0.1.zip
   creating: customization/
   inflating: artifact-list.yaml
   creating: customization/maven-repository/
   [...]

$ cp -r customization/maven-repositry/* /home/wildfly/custom/repository/ #<b class="conum">(3)</b>

$ ./prospero.sh updates perform #<b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Location of existing customization repository</p>
</li>
<li>
<p>Extracting updated repository</p>
</li>
<li>
<p>Adding updated content to existing repository</p>
</li>
<li>
<p>Apply updated customizations</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a repository manager like Nexus is used to host the customization repository, the artifacts should be deployed into it.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When promoting different versions of the same customization bundle, older versions of the bundle should never be promoted after a newer version is promoted. The customization repository contains <code>maven-metadata.xml</code> files associated with the customization&#8217;s manifest that would be overwritten by such operation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_apply_changes_to_the_server">6.5. Apply changes to the server</h3>
<div class="paragraph">
<p>After promoting artifacts to the channel, the changes can be applied to subscribed servers.</p>
</div>
<div class="paragraph">
<p>Promoted changes are treated as any updates, so <code>prospero update</code> command can be used to apply them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>prospero update --dir=&lt;PATH/TO/SERVER&gt;
Feature-packs resolved.
Updates found:
  foo:bar                             1.2.3         ==&gt;  1.2.3-patch0001</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
During update, the latest artifacts available in all registered channels are chosen. If the main channel is updated with newer version of artifact then available in the custom channel, the customized artifact will be removed from the server.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_channels">7. Working with channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>More information on the Wildfly Channels can be found in <a href="https://github.com/wildfly-extras/wildfly-channel/blob/main/doc/spec.adoc" class="bare">https://github.com/wildfly-extras/wildfly-channel/blob/main/doc/spec.adoc</a>. This chapter is intended to explain some concepts behind different channel types and how they can be used to provide software updates.</p>
</div>
<div class="paragraph">
<p>A channel contains a collections of artifact streams used by a server. Each stream should contain only backwards-compatible artifact updates with new versions of artifacts replacing previous ones.</p>
</div>
<div class="paragraph">
<p>There are two ways for a stream to determine the versions of its artifact:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using an artifact manifest with fixed versions, or</p>
</li>
<li>
<p>use the latest artifact version available in backing Maven repository.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The two mechanisms can be mixed within one channel, using static list to resolve some streams and Maven metadata for others.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Channels using exclusively fixed version manifest can be more stable and make it possible to use 3rd party repositories. The artifact combination in the manifest can be tested before distributing, making sure there are no regressions.</p>
</div>
<div class="paragraph">
<p>On the other hand channels using Maven metadata can make development and testing of new component updates easier. Any component updates deployed into the Maven repository are immediately made available to the subscribed servers.</p>
</div>
<div class="sect2">
<h3 id="_channels_with_fixed_version_manifests">7.1. Channels with fixed version manifests</h3>
<div class="paragraph">
<p>This kind of channels rely on manifests to list all available artifacts and their versions. This can be useful when the content of the repository cannot be fully controlled and might contain incompatible artifact versions.</p>
</div>
<div class="paragraph">
<p>The manifest is a YAML file, containing a list of available streams:</p>
</div>
<div class="listingblock">
<div class="title">manifest.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "1.0.0"
name: "test-manifest"
streams:
  - groupId: "org.test"
    artifactId: "artifact-one"
    version: "1.2.0.Final"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The manifest has to be deployed in the channel repository and registered in the channel definition:</p>
</div>
<div class="listingblock">
<div class="title">channel.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "2.0.0"
name: "test-channel"
resolve-if-no-stream: none #(1)
repositories:
  - id: "trusted"
    url: "https://trusted.repository.org/maven/"
manifest:
  maven:
    groupId: org.test.channel
    artifactId: test-manifest</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this channel provides only artifacts explicitly listed in the manifest</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_updating_components_in_fixed_version_channel">7.1.1. Updating components in fixed version channel</h4>
<div class="paragraph">
<p>Updating a component in a manifest channel requires publishing a new version of manifest.</p>
</div>
<div class="paragraph">
<p>For example, if the <code>org.test:artifact-one</code> is updated to <code>1.2.1.Final</code> version, the new manifest would look like as follows:</p>
</div>
<div class="listingblock">
<div class="title">manifest.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "1.0.0"
name: "test-manifest"
streams:
  - groupId: "org.test"
    artifactId: "artifact-one"
    version: "1.2.1.Final"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This manifest has to be published in the channel repository with a new version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn deploy:deploy-file -Dfile=manifest.yaml \
-DgroupId=org.test.channels -DartifactId=test-manifest \
-Dversion=1.0.1 \ #(1)
-Dclassifier=manifest -Dpackaging=yaml \
-Durl=https://trusted.repository.org/maven/</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>note the updated version</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are no changes required to the channel definition. Next time components are resolved from this channel, a new version of manifest will be used providing version <strong>1.2.1.Final</strong> of <code>org.test:artifact-one</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_channels_using_backing_maven_repository_versions">7.2. Channels using backing Maven repository versions</h3>
<div class="paragraph">
<p>This type of channels expose the latest available versions of artifacts found in their repositories as the component version. The versions can be curated using either version patterns or a blocklist excluding specific versions.</p>
</div>
<div class="paragraph">
<p>Channels based on Maven metadata can be useful when the content of repositories can be controlled and trusted. Any new artifact deployed into the channel repository, will automatically be made available for subscribed servers.</p>
</div>
<div class="paragraph">
<p>An example of channel exposing all underlying artifacts can be seen below:</p>
</div>
<div class="listingblock">
<div class="title">channel.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "2.0.0"
name: "test-channel"
resolve-if-no-stream: latest #(1)
repositories: #(2)
  - id: "trusted"
    url: "https://trusted.repository.org/maven/"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>latest</code> strategy means that if channel cannot find a stream matching the requested artifact, it will attempt to find the latest version in its repositories</p>
</li>
<li>
<p>the underlying repository for the channel</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_using_version_patterns_to_limit_artifacts">7.2.1. Using version patterns to limit artifacts</h4>
<div class="paragraph">
<p>Sometimes the underlying repository might contain versions of artifacts that are not compatible with the installed server. For example the server might require a <strong>1.2.x</strong> version of a certain artifact, but the repository contains a newer version <strong>2.0.x</strong>.</p>
</div>
<div class="paragraph">
<p>To filter incompatible versions, the channel can use a manifest file with <code>versionPattern</code> streams.</p>
</div>
<div class="listingblock">
<div class="title">manifest.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "1.0.0"
name: "test-manifest"
streams:
  - groupId: "org.test"
    artifactId: "artifact-one"
    versionPattern: "1\\.2\\..*" #(1)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">regular expression</a> limiting versions to ones starting with <code>1.2.</code></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>versionPattern</code> field uses regular expressions
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above manifest file should be deployed in the channel repository with a classifier <code>manifest</code> and extension <code>yaml</code>. For example following command will deploy the file as <code>org.test.channels:test-manifest:1.0.0</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn deploy:deploy-file -Dfile=manifest.yaml \
  -DgroupId=org.test.channels -DartifactId=test-manifest \
  -Dversion=1.0.0 -Dclassifier=manifest -Dpackaging=yaml \
  -Durl=https://trusted.repository.org/maven/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel definition needs to be updated to reference the new manifest file:</p>
</div>
<div class="listingblock">
<div class="title">channel.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "2.0.0"
name: "test-channel"
resolve-if-no-stream: latest
repositories:
  - id: "trusted"
    url: "https://trusted.repository.org/maven/"
manifest:
  maven:
    groupId: org.test.channel
    artifactId: test-manifest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this channel definition, all artifacts apart from <code>org.test:artifact-one</code> are still resolved to the latest versions available in the repository. The <code>org.test:artifact-one</code> will be resolved to the latest available "1.2.x" micro version. For example, if the repository contains versions [<strong>1.2.0.Final</strong>, <strong>1.2.1.Final</strong>, <strong>2.0.0.Final</strong>], the channel will pick version <strong>1.2.1.Final</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_blocklist_to_exclude_updates">7.2.2. Creating blocklist to exclude updates</h4>
<div class="paragraph">
<p>Another option to exclude certain artifact versions is to use a blocklist. A blocklist is a YAML file deployed in the channel repository listing blocked artifact versions.</p>
</div>
<div class="listingblock">
<div class="title">blocklist.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "1.0.0"
name: "test-blocklist"
blocks:
  - groupId: "org.test"
    artifactId: "artifact-one"
    versions:
    - "1.2.2.Final"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the blocklist has to be deployed in the channel repository. The blocklist artifact has to use <code>blocklist</code> classifier and <code>yaml</code> extension. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn deploy:deploy-file -Dfile=blocklist.yaml \
  -DgroupId=org.test.channels -DartifactId=test-blocklist \
  -Dversion=1.0.0 -Dclassifier=blocklist -Dpackaging=yaml \
  -Durl=https://trusted.repository.org/maven/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the channel definition has to be updated with the reference to the blocklist:</p>
</div>
<div class="listingblock">
<div class="title">channel.yaml</div>
<div class="content">
<pre class="highlight"><code>schemaVersion: "2.0.0"
name: "test-channel"
resolve-if-no-stream: latest
blocklist:
  maven:
    groupId: org.test.channel
    artifactId: test-blocklist
repositories:
  - id: "trusted"
    url: "https://trusted.repository.org/maven/"
manifest:
  maven:
    groupId: org.test.channel
    artifactId: test-manifest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resolving <code>org.test:artifact-one</code> from this channel will exclude any versions not matching "1.2.<strong>" pattern and version 1.2.2.Final. For example, if the repository contains versions [*1.2.0.Final</strong>, <strong>1.2.1.Final</strong>, <strong>1.2.2.Final</strong>, <strong>2.0.0.Final</strong>], the channel will pick version <strong>1.2.1.Final</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_updating_components_using_open_channel">7.2.3. Updating components using "open" channel</h4>
<div class="paragraph">
<p>Updating component in an open channel requires only deploying the artifact into the channel repository. Neither channel definition not channel manifest has to be changed. Next time components are resolved from this channel, a new version of updated component will be used.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-10-25 21:35:12 +0100
</div>
</div>
</body>
</html>